jQuery(function(a){a(".tips").tooltip(),a("select.grant_access_id").chosen(),a("ul.order-status").on("click","a.dokan-edit-status",function(b){return a(this).addClass("dokan-hide").closest("li").next("li").removeClass("dokan-hide"),!1}),a("ul.order-status").on("click","a.dokan-cancel-status",function(b){return a(this).closest("li").addClass("dokan-hide").prev("li").find("a.dokan-edit-status").removeClass("dokan-hide"),!1}),a("form#dokan-order-status-form").on("submit",function(b){b.preventDefault();var c=a(this),d=c.closest("li");d.block({message:null,overlayCSS:{background:"#fff url("+dokan.ajax_loader+") no-repeat center",opacity:.6}}),a.post(dokan.ajaxurl,c.serialize(),function(a){d.unblock();var b=d.prev();d.addClass("dokan-hide"),b.find("label").replaceWith(a),b.find("a.dokan-edit-status").removeClass("dokan-hide")})}),a("form#add-order-note").on("submit",function(b){return b.preventDefault(),a("textarea#add-note-content").val()?(a("#dokan-order-notes").block({message:null,overlayCSS:{background:"#fff url("+dokan.ajax_loader+") no-repeat center",opacity:.6}}),a.post(dokan.ajaxurl,a(this).serialize(),function(b){a("ul.order_notes").prepend(b),a("#dokan-order-notes").unblock(),a("#add-note-content").val("")}),!1):void 0}),a("#dokan-order-notes").on("click","a.delete_note",function(){var b=a(this).closest("li.note");a("#dokan-order-notes").block({message:null,overlayCSS:{background:"#fff url("+dokan.ajax_loader+") no-repeat center",opacity:.6}});var c={action:"dokan_delete_order_note",note_id:a(b).attr("rel"),security:a("#delete-note-security").val()};return a.post(dokan.ajaxurl,c,function(c){a(b).remove(),a("#dokan-order-notes").unblock()}),!1}),a(".order_download_permissions").on("click","button.grant_access",function(){var b=a(this),c=a("select.grant_access_id").val();if(c){a(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff url("+dokan.ajax_loader+") no-repeat center",opacity:.6}});var d={action:"dokan_grant_access_to_download",product_ids:c,loop:a(".order_download_permissions .panel").size(),order_id:b.data("order-id"),security:b.data("nonce")};return a.post(dokan.ajaxurl,d,function(b){b?a("#accordion").append(b):alert("Could not grant access - the user may already have permission for this file or billing email is not set. Ensure the billing email is set, and the order has been saved."),a(".datepicker").datepicker(),a(".order_download_permissions").unblock()}),!1}}),a(".order_download_permissions").on("click","button.revoke_access",function(b){b.preventDefault();var c=confirm("Are you sure you want to revoke access to this download?");if(c){var d=a(this),e=d.closest(".dokan-panel"),f=d.attr("rel").split(",")[0],g=d.attr("rel").split(",")[1];if(f>0){a(e).block({message:null,overlayCSS:{background:"#fff url("+dokan.ajax_loader+") no-repeat center",opacity:.6}});var h={action:"dokan_revoke_access_to_download",product_id:f,download_id:g,order_id:d.data("order-id"),security:d.data("nonce")};a.post(dokan.ajaxurl,h,function(b){a(e).fadeOut("300",function(){a(e).remove()})})}else a(e).fadeOut("300",function(){a(e).remove()})}return!1})}),function(a){var b={init:function(){a("#woocommerce-order-items").on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".wc-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("keyup",".woocommerce_order_items .split-input input:eq(0)",function(){var b=a(this).next();(""===b.val()||b.is(".match-total"))&&b.val(a(this).val()).addClass("match-total")}).on("keyup",".woocommerce_order_items .split-input input:eq(1)",function(){a(this).removeClass("match-total")})},block:function(){a("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a("#woocommerce-order-items").unblock()},reload_items:function(){var c={order_id:dokan_refund.post_id,action:"dokan_load_order_items",security:dokan_refund.order_item_nonce};b.block(),a.ajax({url:dokan_refund.ajax_url,data:c,type:"POST",success:function(b){a(".dokan-panel-default #woocommerce-order-items").empty(),a(".dokan-panel-default #woocommerce-order-items").append(b)}})},refund_items:function(){return a("div.wc-order-refund-items").slideDown(),a("div.wc-order-bulk-actions").slideUp(),a("div.wc-order-totals-items").slideUp(),a("#woocommerce-order-items div.refund").show(),a(".wc-order-edit-line-item .wc-order-edit-line-item-actions").hide(),!1},cancel:function(){return a(this).closest("div.wc-order-data-row").slideUp(),a("div.wc-order-bulk-actions").slideDown(),a("div.wc-order-totals-items").slideDown(),a("#woocommerce-order-items div.refund").hide(),a(".wc-order-edit-line-item .wc-order-edit-line-item-actions").show(),"true"===a(this).attr("data-reload")&&b.reload_items(),!1},refunds:{do_refund:function(){if(b.block(),window.confirm(dokan_refund.i18n_do_refund)){var c=a("input#refund_amount").val(),d=a("input#refund_reason").val(),e={},f={},g={};a(".refund input.refund_order_item_qty").each(function(b,c){a(c).closest("tr").data("order_item_id")&&c.value&&(e[a(c).closest("tr").data("order_item_id")]=c.value)}),a(".refund input.refund_line_total").each(function(b,c){a(c).closest("tr").data("order_item_id")&&(f[a(c).closest("tr").data("order_item_id")]=accounting.unformat(c.value,dokan_refund.mon_decimal_point))}),a(".refund input.refund_line_tax").each(function(b,c){if(a(c).closest("tr").data("order_item_id")){var d=a(c).data("tax_id");g[a(c).closest("tr").data("order_item_id")]||(g[a(c).closest("tr").data("order_item_id")]={}),g[a(c).closest("tr").data("order_item_id")][d]=accounting.unformat(c.value,dokan_refund.mon_decimal_point)}});var h={action:"dokan_refund_request",order_id:dokan_refund.post_id,refund_amount:c,refund_reason:d,line_item_qtys:JSON.stringify(e,null,""),line_item_totals:JSON.stringify(f,null,""),line_item_tax_totals:JSON.stringify(g,null,""),api_refund:a(this).is(".do-api-refund"),restock_refunded_items:a("#restock_refunded_items:checked").size()?"true":"false",security:dokan_refund.order_item_nonce};a.post(dokan_refund.ajax_url,h,function(a){!0===a.success?(window.alert(a.data),b.reload_items()):(window.alert(a.data),b.unblock())})}else b.unblock()},input_changed:function(){var b=0,c=a(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping");c.each(function(){var c=a(this),d=c.find(".refund input:not(.refund_order_item_qty)");d.each(function(c,d){b+=parseFloat(accounting.unformat(a(d).val()||0,dokan_refund.mon_decimal_point))})}),a("#refund_amount").val(accounting.formatNumber(b,dokan_refund.currency_format_num_decimals,"",dokan_refund.mon_decimal_point)).change()},amount_changed:function(){var b=accounting.unformat(a(this).val(),dokan_refund.mon_decimal_point);a("button .wc-order-refund-amount .amount").text(accounting.formatMoney(b,{symbol:dokan_refund.currency_format_symbol,decimal:dokan_refund.currency_format_decimal_sep,thousand:dokan_refund.currency_format_thousand_sep,precision:dokan_refund.currency_format_num_decimals,format:dokan_refund.currency_format}))},refund_quantity_changed:function(){var b=a(this).closest("tr.item"),c=b.find("input.quantity").val(),d=a(this).val(),e=a("input.line_total",b),f=a("input.refund_line_total",b),g=accounting.unformat(e.attr("data-total"),dokan_refund.mon_decimal_point)/c;f.val(parseFloat(accounting.formatNumber(g*d,dokan_refund.rounding_precision,"")).toString().replace(".",dokan_refund.mon_decimal_point)).change(),a("td.line_tax",b).each(function(){var b=a("input.line_tax",a(this)),e=a("input.refund_line_tax",a(this)),f=accounting.unformat(b.attr("data-total_tax"),dokan_refund.mon_decimal_point)/c;f>0?e.val(parseFloat(accounting.formatNumber(f*d,dokan_refund.rounding_precision,"")).toString().replace(".",dokan_refund.mon_decimal_point)).change():e.val(0).change()}),d>0?a("#restock_refunded_items").closest("tr").show():(a("#restock_refunded_items").closest("tr").hide(),a(".woocommerce_order_items input.refund_order_item_qty").each(function(){a(this).val()>0&&a("#restock_refunded_items").closest("tr").show()})),a(this).trigger("refund_quantity_changed")}}};b.init()}(jQuery);